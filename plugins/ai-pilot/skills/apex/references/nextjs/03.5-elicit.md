---
name: 03.5-elicit
description: Next.js expert self-review using elicitation techniques
prev_step: references/nextjs/03-execution.md
next_step: references/nextjs/04-validation.md
---

# 03.5-elicit - Next.js Expert Self-Review

Next.js expert self-reviews code using elicitation techniques before sniper validation.

---

## Next.js Specific Techniques

### Auto-Detection for Next.js Code

| Code Type | Auto-Selected Techniques |
|-----------|--------------------------|
| Server Components | ARCH-01 (SOLID), PERF-01 (Data fetching), SEC-01 (Server) |
| Client Components | UX-01 (Hydration), TEST-01 (Edge), ARCH-04 (Bundle) |
| API Routes | SEC-02 (Input), INT-01 (Contract), DOC-01 (OpenAPI) |
| Server Actions | SEC-03 (CSRF), DATA-01 (Validation), TEST-02 (Error) |
| Middleware | SEC-01 (Auth), PERF-03 (Performance), INT-02 (Compat) |
| Database (Prisma) | PERF-01 (N+1), DATA-02 (Migration), CONC-06 (Transaction) |

---

## Next.js Priority Checks

### 1. Server vs Client Boundary
```text
â–¡ "use client" only where needed
â–¡ No unnecessary client components
â–¡ Server components for data fetching
â–¡ Client components for interactivity only
```

### 2. Data Fetching Patterns
```text
â–¡ No fetch in client components (use Server Actions)
â–¡ Proper caching strategy (revalidate)
â–¡ No waterfall requests
â–¡ Parallel data fetching where possible
```

### 3. Server Actions Security
```text
â–¡ Input validation with Zod
â–¡ Auth check in every action
â–¡ Rate limiting consideration
â–¡ CSRF protection (automatic in Next.js)
```

### 4. Hydration Safety
```text
â–¡ No window/document in server code
â–¡ useEffect for client-only code
â–¡ Consistent server/client rendering
â–¡ No hydration mismatches
```

---

## Technique Quick Reference (Next.js)

| ID | Technique | Next.js Focus |
|----|-----------|---------------|
| SEC-01 | Server Security | Server Components, API Routes auth |
| SEC-02 | Input Validation | Server Actions Zod schemas |
| SEC-03 | CSRF Protection | Server Actions verification |
| PERF-01 | N+1 Detection | Prisma queries in loops |
| PERF-04 | Bundle Size | Client component imports |
| ARCH-01 | SOLID | Module separation |
| ARCH-04 | File Size | <100 lines per file |
| UX-01 | Hydration | Server/Client consistency |
| TEST-01 | Edge Cases | Loading/Error states |
| DOC-01 | API Docs | Route handlers documentation |

---

## Example: Server Action Review

```typescript
// Before elicitation
export async function createUser(data: FormData) {
  const name = data.get('name')
  await prisma.user.create({ data: { name } })
}

// After SEC-02 + SEC-03 + DATA-01
export async function createUser(data: FormData) {
  const session = await auth()
  if (!session) throw new Error('Unauthorized')

  const validated = createUserSchema.safeParse({
    name: data.get('name')
  })
  if (!validated.success) throw new Error('Invalid input')

  await prisma.user.create({ data: validated.data })
  revalidatePath('/users')
}
```

---

## Output Format

```text
## ðŸŸ£ Next.js Elicitation Report

Framework: Next.js 16
Mode: auto
Code Type: Server Action

### Applied Techniques
1. SEC-02: Input Validation â†’ Added Zod schema
2. SEC-03: Auth Check â†’ Added session verification
3. DATA-01: Schema Validation â†’ safeParse pattern

### Corrections Made
- Added authentication check
- Added Zod validation schema
- Added revalidatePath for cache

â†’ Ready for 04-validation (sniper)
```

---

## Next Step

â†’ `04-validation.md`: sniper with Next.js linters (ESLint, TypeScript)
